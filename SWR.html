<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/assets/styles/styles.css">
<link rel="stylesheet" href="https://indestructibletype.com/fonts/Jost.css" type="text/css" charset="utf-8" />
<script src="https://kit.fontawesome.com/79c31398dc.js" crossorigin="anonymous"></script>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/EasySensorsLogo-150x150.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/EasySensorsLogo-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/EasySensorsLogo-16x16.png">
<link rel="manifest" href="/assets/img/site.webmanifest">
<link rel="mask-icon" href="/assets/img/EasySensorsLogo.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/EasySensorsLogo-32x32.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- feed -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="easySensors blog" />




<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Connecting EasySwitch box to Domoticz home automation controller. | easySensors blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Connecting EasySwitch box to Domoticz home automation controller." />
<meta name="author" content="easySensors team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We have a deep admiration for the RFM LoRa radio and Arduino-compatible processors from Microchip, and here are a few reasons why:" />
<meta property="og:description" content="We have a deep admiration for the RFM LoRa radio and Arduino-compatible processors from Microchip, and here are a few reasons why:" />
<link rel="canonical" href="http://localhost:4000/SWR.html" />
<meta property="og:url" content="http://localhost:4000/SWR.html" />
<meta property="og:site_name" content="easySensors blog" />
<meta property="og:image" content="http://localhost:4000/assets/img/domoticz.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-20T00:00:00-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/domoticz.jpg" />
<meta property="twitter:title" content="Connecting EasySwitch box to Domoticz home automation controller." />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"easySensors team"},"dateModified":"2023-03-20T00:00:00-07:00","datePublished":"2023-03-20T00:00:00-07:00","description":"We have a deep admiration for the RFM LoRa radio and Arduino-compatible processors from Microchip, and here are a few reasons why:","headline":"Connecting EasySwitch box to Domoticz home automation controller.","image":"http://localhost:4000/assets/img/domoticz.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/SWR.html"},"url":"http://localhost:4000/SWR.html"}</script>
<!-- End Jekyll SEO tag -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1FNJQFG0KL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1FNJQFG0KL');
</script>



  </head>
  <body>
    <aside class="menu">
    <div class="menu-top">
        <div class="menu-top_logo">
            <a href="/" >
                <img src="/assets/img/band_logo.png" alt="Logo" onerror="this.style.display='none'">
            </a>
        </div>
        <div class="menu-top_expand" onclick="toggleExpander(this)">
            <div class="bar_top"></div>
            <div class="bar_middle"></div>
            <div class="bar_bottom"></div>
        </div>
        <ul class="navigation">
            
            <li>
                <a href="/" category="home" title=""
                
                    class="selected"
                
                >
                    <span>Home</span>
                </a>
            </li>
            
            <li>
                <a href="/ESP32_S2/" category="ESP32_S2" title="Made for ESPHome ESP32_S2 based devices"
                
                >
                    <span>ESP32_S2</span>
                </a>
            </li>
            
            <li>
                <a href="/LoRa-RFM/" category="LoRa-RFM" title="LoRa and RFM69 Arduino based devices"
                
                >
                    <span>LoRa-RFM</span>
                </a>
            </li>
            
            <li>
                <a href="/about.html" category="about" title="about easySensors"
                
                >
                    <span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="menu-contact">
        

        <a href="https://github.com/easysensors" target="_blank">
            <i class="fab fa-github"></i>
        </a>
        
    </div>
</aside>

      <main class="content-layout">
          <div class="post">
    <div class="content-container home">

        <header>
            <h1>Connecting EasySwitch box to Domoticz home automation controller.</h1>
            
                <figure class="post-cover">
                    <div class="click-to-enlarge">
                        <img
                            click-to-enlarge
                            
                            alt="Post image cover"
                            
                            class="post-cover_image webfeedsFeaturedVisual"
                            src="/assets/img/domoticz.jpg"
                            
                        />
                    </div>
                </figure>
            
        </header>
        <div class="post-content">
            <p>We have a deep admiration for the RFM LoRa radio and Arduino-compatible processors from Microchip, and here are a few reasons why:</p>

<ul>
  <li>Easy to Learn: Learning to use this technology is a breeze. Thanks to the efforts of  various lib authors such as Low Power Lab, Airspyce, and MySensors, the code is lightweight and  easy to comprehend.</li>
  <li>Free Programming IDE: The fact that the programming IDE is free is a major advantage when compared to other technologies like Zigbee. For example, if you want to use the free ZHA stack  from Texas Instruments, you need to purchase a costly IDE to compile code into binaries. With the open-source Arduino Software (IDE), you get a great tool that takes care of a lot of things  for you.</li>
  <li>Great Libraries: We have tested many libraries, and the ones we used from MySensors have  been a staple in our projects for years. They are incredibly useful for home automation   projects.</li>
</ul>

<p>Other things worth mentioning:</p>
<ul>
  <li>The switchbox is powered by a coin cell battery, so it’s crucial to send the processor and radio into sleep mode to extend battery life. Otherwise, it may only last a few hours or less.</li>
  <li>it is important to consider the device’s power source, which is coin cell batteries. As such, the values for #define MY_RFM95_TX_POWER_DBM or #define MY_RFM69_TX_POWER_DBM should be selected carefully to avoid quick battery depletion.</li>
  <li>Air sanity is important when using radiofrequency. Please be cautious with retries and tests, and avoid taking too much airtime for sending packets, as the radiofrequency is free for all.</li>
</ul>

<p>To link the EasySwitch box with the Domoticz home automation controller, For seamless connectivity with the home automation controller, it is recommended to use a serial gateway built on the <a href="https://easysensors.github.io/nano-shield-node.html">NanoShield module</a></p>

<h2 id="arduino-ide-settings-for-easyswitchbox">Arduino IDE Settings for EasySwitchBox</h2>
<p><img src="https://github.com/EasySensors/ButtonSizeNode/blob/master/pics/IDEsettings.jpg?raw=true" alt="" /></p>
<h2 id="programming-ftdi-adapter-connection">programming FTDI adapter connection</h2>
<p><img src="https://github.com/EasySensors/SwitchNode/blob/master/pics/FTDIvcc3.jpg?raw=true" alt="" /></p>

<p>Mysensors is a community that provides open-source hardware and software solutions for DIY home automation and Internet of Things (IoT) projects. Their library set is specifically geared towards home automation and is designed to support both RFM69 and LoRa RFM95.
You can easily define the radio type and frequencies by specifying them in the following lines.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#define MY_RADIO_RFM69</span>
//#define MY_IS_RFM69HW  
</code></pre></div></div>
<p>Or</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#define MY_RADIO_RFM95</span>
<span class="c">#define MY_RFM69_FREQUENCY   RFM69_915MHZ</span>
</code></pre></div></div>
<p>RFM 95 Modem settings :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#define MY_RFM95_MODEM_CONFIGRUATION RFM95_BW_500KHZ | RFM95_CODING_RATE_4_5, RFM95_SPREADING_FACTOR_2048CPS | RFM95_RX_PAYLOAD_CRC_ON, RFM95_AGC_AUTO_ON // </span>
<span class="c">#define MY_RFM95_TX_POWER_DBM (20u)</span>
<span class="c">#define   MY_RFM95_FREQUENCY RFM95_915MHZ</span>
</code></pre></div></div>
<p>The code allows for sending messages to specific relays or to the home automation controller with the address of 0.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int relayNodeID[2] <span class="o">=</span> <span class="o">{</span>0, 0<span class="o">}</span><span class="p">;</span> 
</code></pre></div></div>
<p>The relay addresses for each button to send switch ON/OFF states can be set to any address, where 0 is the address for the SmartHome controller.
These buttons are defined as child or sensor numbers, and a NULL value means that there is no need to report or present it to the controller.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int relayChildID[3] <span class="o">=</span> <span class="o">{</span>4, 4<span class="o">}</span><span class="p">;</span> 
</code></pre></div></div>
<p>NULL value means no need to report\present it to cntroller;</p>

<p>The switchBox must be given a Node ID on the mySensors network, which can be done manually using</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#define MY_NODE_ID 0x43 or automatically if connected to a Home automation controller using #define MY_NODE_ID AUTO.</span>
</code></pre></div></div>
<p>Let’s take a look at how you can connect an EasySwitchBox and Nano Shield to the Domoticz home automation controller:</p>
<ol>
  <li>Burn the EasySwitchBox.ino file into the EasySwitchBox and the GatewaySerial.ino file into the Nano Shield.</li>
  <li>To install Domoticz on a Raspberry Pi, open the terminal and run the following command:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sSL</span> install.domoticz.com | <span class="nb">sudo </span>bash
</code></pre></div>    </div>
  </li>
  <li>To ensure that Domoticz starts automatically, run the following commands:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>domoticz
<span class="nb">sudo cp </span>domoticz.sh /etc/init.d
<span class="nb">sudo chmod</span> +x /etc/init.d/domoticz.sh
<span class="nb">sudo </span>update-rc.d domoticz.sh defaults
</code></pre></div>    </div>
  </li>
  <li>Edit the startup script by running the following command:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/init.d/domoticz.sh
</code></pre></div>    </div>
  </li>
  <li>Point your browser to the IP address of your Raspberry Pi, for example: http://192.168.0.10:8080.</li>
  <li>For more details on starting Domoticz automatically when the system boots, check out this <img src="https://www.domoticz.com/wiki/Linux#Starting_Domoticz_automatically_when_the_system_boots." alt="link:" /></li>
  <li>Add the GatewaySerial as new hardware in the Domoticz interface.
<img src="assets/img/domoticz_setup.png" alt="EasySwitchBox Antenna Efficiency Tuning" />
<img src="assets/img/domoticz_setup2.png" alt="EasySwitchBox Antenna Efficiency Tuning" /></li>
</ol>

<p>To locate the easySwitchBox, you will need to reset it.</p>

        </div>
        <div class="post-metadata">
            <p class="discography-album_release-date">
    date: 20 March 2023
</p>

















        </div>
    </div>
</div>

          <script>
    window.addEventListener("load", () => {
        document.getElementsByClassName("copyrights")[0].innerHTML = 
            `Copyrights &copy; ${new Date().getFullYear()} Site Author`;
    });
</script>
<footer>
    <p class="copyrights">
    </p>
</footer>
      </main>
      
      <script>
        
(function() {
    const interactedWithCookiesBanner = "interacted_with_cookies_banner";
    const storageType = localStorage;
    const cookieContainerId = "cookieContainer";

    acceptAllCookieConsent = () => {
        
            eval("storageType.setItem('GA', true);");
        
            eval("storageType.setItem('SA', true);");
        
    }

    window.cookiesAcceptDefaultFn = () => {
        const cookieContainer = document.getElementById(cookieContainerId);
        cookieContainer.classList.add("hidden");
        window.setTimeout(cookieContainer.remove.bind(cookieContainer), 1000);
        storageType.setItem(interactedWithCookiesBanner, true);
        acceptAllCookieConsent();
    }
    window.cookiesDisagreeDefaultFn = () => {
        const cookieContainer = document.getElementById(cookieContainerId);
        cookieContainer.classList.add("hidden");
        window.setTimeout(cookieContainer.remove.bind(cookieContainer), 1000);
        storageType.setItem(interactedWithCookiesBanner, true);
        window.location = `http://localhost:4000/cookies`;
    }

    window.addEventListener("load", () => {
        if(storageType.getItem(interactedWithCookiesBanner) === "true" || window.location.href.indexOf("cookies") !== -1) {
            return;
        }
        const cookieContainer = document.createElement("div");
        cookieContainer.setAttribute("id", cookieContainerId);
        cookieContainer.classList.add("hidden");

        const cookieHeader = document.createElement("h2");
        const cookieHeaderContent = document.createTextNode("Ask your users if they agree to cookies");

        const cookieParagraph = document.createElement("p");
        const cookieParagraphContent = document.createTextNode("This site might be using cookies! Customize your message or disable cookies in metaData.yml!");

        const cookieButtonsContainer = document.createElement("div");
        cookieButtonsContainer.classList.add("cookie-container--buttons");

        const cookieAgreeButton = document.createElement("button");
        const cookieButtonContent = document.createTextNode("Yes, I agree");
        cookieAgreeButton.appendChild(cookieButtonContent);
        eval("cookieAgreeButton.onclick = cookiesAcceptDefaultFn;");

        const cookieButtonDisagree = document.createElement("button");
        const cookieButtonDisagreeContent = document.createTextNode("No, take me to settings");
        cookieButtonDisagree.append(cookieButtonDisagreeContent);
        eval("cookieButtonDisagree.onclick = cookiesDisagreeDefaultFn;");

        cookieHeader.append(cookieHeaderContent);
        cookieParagraph.append(cookieParagraphContent);
        cookieButtonsContainer.append(cookieAgreeButton, cookieButtonDisagree)
        cookieContainer.append(cookieHeader, cookieParagraph, cookieButtonsContainer);
        cookieContainer.classList.add("cookie-container")
        document.body.appendChild(cookieContainer);
        window.setTimeout(() => cookieContainer.classList.remove("hidden"));
    });
})();

      </script>
    
    <script>
      (function () {
    window.toggleExpander = function toggleExpander(x) {
        const menu = document.getElementsByClassName("menu")[0];
        const navigation = document.getElementsByClassName("navigation")[0];
        if (menu.classList.contains('expanded--visible')) {
            menu.classList.toggle('expanded--visible');
            navigation.addEventListener('transitionend', function(e) {
                menu.classList.toggle("expanded");
              }, {
                capture: false,
                once: true,
                passive: false
              });
        } else {
            menu.classList.toggle("expanded");
            setTimeout(() => menu.classList.toggle('expanded--visible'), 20);
        }
    };
    window.addEventListener("load", () => {
        // #region click to enlarge images 
        const imageWrappers = document.querySelectorAll(".click-to-enlarge");
        imageWrappers.forEach(imageWrapper => {
            
            imageWrapper.addEventListener("click", () => {
                const img = imageWrapper.getElementsByTagName("img")[0];
                const src = img.attributes.getNamedItem("src");
                const modal = document.createElement("div");
                const removeModal = function() {
                    modal.classList.add("hidden");
                    setTimeout(() => {
                        document.body.removeChild(modal);
                    }, 200);
                };
                const newImage = document.createElement("img");
                newImage.classList.add("modal__picture-zoomed--image");
                newImage.setAttribute("src", src.value);
                modal.classList.add("modal__picture-zoomed", "hidden");
                // modal.style.backgroundImage = `URL("${src.value}")`;
                modal.addEventListener("click", removeModal);
                modal.append(newImage);
                document.body.append(modal);
                document.body.addEventListener("keyup", e => {
                    if (e.key === 'Escape') {
                        removeModal();
                    }
                }, {once : true});
                setTimeout(() => {
                    modal.classList.remove("hidden");
                }, 0);
            });
            
        });
        // #endregion click to enlarge images 
        // #region embedded audio players
        const players = document.querySelectorAll("iframe.embedded-player");
        const getParamsByPlayerType = (src, type) => {
            const rt = (src, height) => ({
                src: src,
                height: height
            });
            switch (type.toLocaleLowerCase()) {
                case "soundcloud":
                    return rt(`https://w.soundcloud.com/player/?url=${src}`, 125);
                case "bandcamp":
                    return rt(`https://bandcamp.com/EmbeddedPlayer/${src}`, 125);
                case "spotify":
                    return rt(`https://open.spotify.com/embed/track/${src}`, 80);
                case "spotifyalbum":
                    return rt(`https://open.spotify.com/embed/album/${src}`, 80);
                case "spotifyplaylist":
                    return rt(`https://open.spotify.com/embed/playlist/${src}`, 80);
                case "spotifyepisode":
                    return rt(`https://open.spotify.com/embed/episode/${src}`, 152);
                case "spotifyshow":
                    return rt(`https://open.spotify.com/embed/show/${src}`, 152);
                case "youtube":
                    return rt(`https://www.youtube.com/embed/${src}`, 350);
                case "anchor.fm":
                    return rt(`https://anchor.fm/sucias/embed/episodes/${src}`,102);
                default:
                    return rt(src, 125);
            }
        };
        players.forEach(player => {
            const givenSrc = player.getAttribute("givenSrc");
            const type = player.getAttribute("type");
            const { src, height } = getParamsByPlayerType(givenSrc, type);
            player.setAttribute("src", src);
            player.setAttribute("height", height);
            player.classList.remove("hidden");
        });
        // #endregion embedded audio players
    });
})();
    </script>
    


  </body>
</html>